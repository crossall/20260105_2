<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>Posture Checker</title>

<!-- 기본 스타일 -->
<style>
    body {
        margin: 0;
        font-family: "Pretendard", "Noto Sans KR", sans-serif;
        background: linear-gradient(135deg, #eef2ff, #f8fafc);
        transition: background 0.6s ease;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
    }

    .app-container {
        width: 360px;
        padding: 24px;
        border-radius: 18px;
        background: white;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08);
        text-align: center;
    }

    h1 {
        font-size: 20px;
        margin-bottom: 12px;
    }

    .subtitle {
        font-size: 13px;
        color: #64748b;
        margin-bottom: 16px;
    }

    button {
        padding: 10px 18px;
        border-radius: 30px;
        border: 0;
        cursor: pointer;
        font-weight: 600;
        background: linear-gradient(135deg, #6366f1, #8b5cf6);
        color: white;
        margin-bottom: 14px;
        transition: transform 0.2s ease;
    }

    button:hover {
        transform: translateY(-2px);
    }

    #webcam-container canvas {
        border-radius: 14px;
    }

    .labels {
        margin-top: 14px;
        text-align: left;
        font-size: 14px;
    }

    .label-item {
        margin: 4px 0;
        padding: 6px 10px;
        border-radius: 10px;
        background: #f1f5f9;
        display: flex;
        justify-content: space-between;
    }
</style>
</head>

<body>

<div class="app-container">
    <h1>바른 자세 체크</h1>
    <div class="subtitle">웹캠을 통해 현재 자세를 확인합니다</div>

    <button type="button" onclick="init()">Start</button>

    <div id="webcam-container"></div>

    <div id="label-container" class="labels"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

<script>
    const URL = "https://teachablemachine.withgoogle.com/models/_YhtGMsfK/";
    let model, webcam, labelContainer, maxPredictions;

    async function init() {
        const modelURL = URL + "model.json";
        const metadataURL = URL + "metadata.json";

        model = await tmImage.load(modelURL, metadataURL);
        maxPredictions = model.getTotalClasses();

        const flip = true;
        webcam = new tmImage.Webcam(240, 240, flip);
        await webcam.setup();
        await webcam.play();
        window.requestAnimationFrame(loop);

        document.getElementById("webcam-container").appendChild(webcam.canvas);

        labelContainer = document.getElementById("label-container");
        for (let i = 0; i < maxPredictions; i++) {
            const div = document.createElement("div");
            div.className = "label-item";
            labelContainer.appendChild(div);
        }
    }

    async function loop() {
        webcam.update();
        await predict();
        window.requestAnimationFrame(loop);
    }

    async function predict() {
        const prediction = await model.predict(webcam.canvas);

        let goodPosture = 0;
        let badPosture = 0;

        for (let i = 0; i < maxPredictions; i++) {
            const p = prediction[i];
            const prob = p.probability.toFixed(2);

            // 텍스트 출력
            labelContainer.childNodes[i].innerHTML =
                `<span>${p.className}</span><span>${(prob * 100).toFixed(0)}%</span>`;

            // 이름에 맞게 매핑
            if (p.className.includes("바른")) goodPosture = p.probability;
            if (p.className.includes("안좋")) badPosture = p.probability;
        }

        // --------------------------
        // 배경색 변경 규칙
        // --------------------------
        if (goodPosture >= 0.5) {
            document.body.style.background =
                "linear-gradient(135deg,#d1fae5,#a7f3d0)";
        } else if (badPosture >= 0.5) {
            document.body.style.background =
                "linear-gradient(135deg,#fff1f2,#fecaca)";
        } else {
            document.body.style.background =
                "linear-gradient(135deg,#eef2ff,#f8fafc)";
        }
    }
</script>

</body>
</html>
